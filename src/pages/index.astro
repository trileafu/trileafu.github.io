---
import Logo from "@/components/Logo.astro";
import Layout from "@/layouts/Layout.astro";
import Aside from "@/assets/aside.svg";
import Contact from "@/assets/contact.svg";
import Portfolio from "@/components/Portfolio.astro";
import Blog from "@/components/Blog.astro";
---

<Layout>
	<style>
		.logoFigure {
			animation-name: logoFigureHorizontalAnim;
			animation-duration: 1s;
			animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
			animation-fill-mode: both;
			animation-delay: 0.9s;
		}
		.logoAside {
			animation-name: logoAsideHorizontalAnim;
			animation-duration: 1s;
			animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
			animation-fill-mode: both;
			animation-delay: 0.9s;
		}

		.logoMain {
			animation-name: logoMainAnim;
			animation-duration: 0.5s;
			animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
			animation-fill-mode: both;
			animation-delay: 0.9s;
		}

		@keyframes logoMainAnim {
			0% {
				background-color: var(--color-trileafu-background);
			}
			100% {
				background-color: white;
			}
		}

		@keyframes logoFigureVerticalAnim {
			0% {
				height: 60vh;
			}
			100% {
				height: 20vh;
			}
		}

		@keyframes logoFigureHorizontalAnim {
			0% {
				width: 80vw;
			}
			100% {
				width: 20vw;
			}
		}
		@keyframes logoAsideVerticalAnim {
			0% {
				filter: blur(24px);
				transform: translateY(240px);
			}
			100% {
				filter: blur(0px);
				transform: translateY(0px);
			}
		}

		@keyframes logoAsideHorizontalAnim {
			0% {
				filter: blur(24px);
				transform: translateX(240px);
			}
			100% {
				filter: blur(0px);
				transform: translateX(0px);
			}
		}
	</style>
	<div
		id="header"
		class="max-sm:min-h-[40lvh] z-10 min-h-[100svh] flex items-center justify-center bg-black absolute top-0 left-0 w-full transition-opacity duration-300"
	>
		<main
			class="logoMain relative flex items-end justify-end overflow-hidden sm:flex-row gap-4 bg-white aspect-[3.375/2.125] w-[80vw]"
		>
			<figure
				class="logoFigure absolute z-20 top-0 left-0 h-full bg-trileafu-background flex items-center justify-center"
			>
				<Logo />
			</figure>
			<aside class="logoAside w-[60vw] h-full">
				<Aside class="w-full h-full" />
			</aside>
		</main>
	</div>
	<div
		id="footer"
		class="max-sm:min-h-[40svh] z-10 min-h-[100svh] flex items-center justify-center bg-black max-sm:absolute max-sm:bottom-0 max-sm:left-0 max-sm:w-full transition-opacity duration-300"
	>
		<main
			class="logoMain relative flex items-end justify-end overflow-hidden sm:flex-row gap-4 bg-white aspect-[3.375/2.125] w-[80vw]"
		>
			<figure
				class="logoFigure absolute z-20 top-0 left-0 h-full bg-trileafu-background flex items-center justify-center"
			>
				<Logo />
			</figure>
			<aside class="logoAside w-[60vw] h-full">
				<Contact class="w-full h-full" />
			</aside>
		</main>
	</div>
	<div
		id="scrolling-content"
		class="absolute z-30 top-0 left-0 w-full h-[100svh] overflow-y-scroll"
	>
		<section class="bg-white max-sm:mt-[40svh] mt-[100svh]" id="contents">
			<Portfolio />
		</section>
		<section class="bg-white max-sm:mb-[40lvh] mb-[100svh]">
			<Blog />
		</section>
	</div>
	<script is:inline>
		const header = document.getElementById("header");
		const footer = document.getElementById("footer");
		const contents = document.getElementById("contents");
		const scrollingContent = document.getElementById("scrolling-content");

		function isMobile() {
			// Tailwind's `sm` breakpoint is 640px
			return window.innerWidth < 640;
		}

		function handleScroll() {
			if (!contents || !header || !footer) return;

			const rect = contents.getBoundingClientRect();
			const isScrolledPast = rect.top <= 0;

			// Header always fades in/out
			header.classList.toggle("opacity-0", isScrolledPast);

			// Footer should only fade on mobile
			if (isMobile()) {
				footer.classList.toggle("opacity-0", isScrolledPast);
			} else {
				// On larger screens, ensure the footer is always visible
				footer.classList.remove("opacity-0");
			}
		}

		function handleResize() {
			// Re-run the scroll logic to adjust the footer's visibility
			handleScroll();
		}

		document.addEventListener("DOMContentLoaded", () => {
			if (scrollingContent) {
				handleScroll(); // Initial check on page load
				scrollingContent.addEventListener("scroll", handleScroll, { passive: true });
				window.addEventListener("resize", handleResize, { passive: true });
			}
		});
	</script>
</Layout>
